#!/bin/bash 

# This bash script creates an AppImage for pdf2htmlEX

source buildScripts/versionEnvs

mkdir -p imageBuild/pdf2htmlEX.AppDir/usr/lib/

cd pdf2htmlEX/build

sudo rm -rf install_manifest.txt

make install DESTDIR=../../imageBuild/pdf2htmlEX.AppDir

cd ../../imageBuild

# force libfontconfig into AppImage (linuxdeploy blacklists libfontconfig)
#
cp /usr/lib/x86_64-linux-gnu/libfontconfig.so.1 pdf2htmlEX.AppDir/usr/lib/

wget https://github.com/linuxdeploy/linuxdeploy/releases/download/continuous/linuxdeploy-x86_64.AppImage

chmod a+x linuxdeploy-x86_64.AppImage

./linuxdeploy-x86_64.AppImage			\
  -e pdf2htmlEX.AppDir/usr/bin/pdf2htmlEX	\
  --create-desktop-file				\
  -i ../pdf2htmlEX/logo/pdf2htmlEX.svg		\
  --appdir=pdf2htmlEX.AppDir			\
  --output appimage

mv pdf2htmlEX-x86_64.AppImage pdf2htmlEX-$PDF2HTMLEX_VERSION-x86_64.AppImage
