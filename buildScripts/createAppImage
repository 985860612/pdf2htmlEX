#!/bin/bash 

# This bash script creates an AppImage for pdf2htmlEX

source buildScripts/versionEnvs

# For appimage output plugin
#
export VERSION="$PDF2HTMLEX_VERSION-$(date +%Y_%m_%d-%H_%M_%S)"
export UPLOADTOOL_BODY="This is the development/testing release of the pdf2htmlEX AppImage. You can download the AppImage and 'just run it'. See: https://appimage.org/ "

mkdir -p imageBuild/appDir/usr/lib/

cd pdf2htmlEX/build

sudo rm -rf install_manifest.txt

make install DESTDIR=../../imageBuild/appDir

cd ../../imageBuild

# force libfontconfig into AppImage (linuxdeploy blacklists libfontconfig)
#
cp /usr/lib/x86_64-linux-gnu/libfontconfig.so.1 appDir/usr/lib/

LINUX_DEPLOY_APP_IMAGE=linuxdeploy-$MACHINE_ARCH.AppImage

wget https://github.com/linuxdeploy/linuxdeploy/releases/download/continuous/$LINUX_DEPLOY_APP_IMAGE

chmod a+x $LINUX_DEPLOY_APP_IMAGE

./$LINUX_DEPLOY_APP_IMAGE		\
  -e appDir/usr/local/bin/pdf2htmlEX	\
  --create-desktop-file			\
  -i ../pdf2htmlEX/logo/pdf2htmlEX.svg	\
  --appdir=appDir			\
  --output appimage

wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh

bash upload.sh pdf2htmlEX*.AppImage


